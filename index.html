<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>My Daily</title>
    <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #fdf6f6;
            --card: #ffffff;
            --accent: #ff6b6b;
            --text: #2c2c2c;
        }

        body { margin:0; font-family:system-ui,sans-serif; background:var(--bg); color:var(--text); height:100vh; overflow:hidden; }

        header {
            padding:18px;
            background:linear-gradient(135deg,#ffeef4,#fff5e6);
            font-family:'Permanent Marker',cursive;
            font-size:2.3rem;
            text-align:center;
            color:#e74c3c;
            text-shadow:3px 3px 0 #fff;
        }

        .main { display:flex; height:calc(100vh - 78px); }

        .dates-sidebar {
            width:110px;
            background:white;
            border-right:1px solid #ffe0e0;
            overflow-y:auto;
            padding:14px 6px;
        }

        .date-item {
            padding:12px 4px;
            text-align:center;
            cursor:pointer;
            border-radius:12px;
            font-size:0.92rem;
            transition:all .2s;
        }

        .date-item.selected { background:#ffe0e0; font-weight:bold; color:#e74c3c; }
        .date-item.today { color:var(--accent); font-weight:bold; }

        .tasks-area { flex:1; display:flex; flex-direction:column; overflow:hidden; }

        .date-title {
            padding:16px 20px 10px;
            font-size:1.45rem;
            font-weight:700;
            text-align:center;
            background:white;
            border-bottom:1px solid #ffd8d8;
        }

        .task-carousel {
            flex:1;
            overflow-y:scroll;
            scroll-snap-type:y mandatory;
            -webkit-overflow-scrolling:touch;
            padding:80px 0 300px; /* –û–ì–†–û–ú–ù–´–ô –Ω–∏–∂–Ω–∏–π –æ—Ç—Å—Ç—É–ø ‚Äî —á—Ç–æ–±—ã –ø–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–¥–∞—á–∞ –º–æ–≥–ª–∞ –≤—Å—Ç–∞—Ç—å —Ä–æ–≤–Ω–æ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
        }

        .task-list {
            display:flex;
            flex-direction:column;
            align-items:center;
            gap:80px; /* –±–æ–ª—å—à–æ–π –ø—Ä–æ–º–µ–∂—É—Ç–æ–∫ ‚Äî —ç—Ñ—Ñ–µ–∫—Ç –º–∞—Å—à—Ç–∞–±–∞ –≤–∏–¥–µ–Ω –¥–∞–∂–µ –Ω–∞ –∫–æ—Ä–æ—Ç–∫–æ–º —Å–ø–∏—Å–∫–µ */
            width:100%;
            max-width:440px;
            margin:0 auto;
        }

        .task {
            background:var(--card);
            border-radius:24px;
            padding:28px 32px;
            width:88%;
            max-width:400px;
            box-shadow:0 6px 30px rgba(231,76,60,0.18);
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:24px;
            position:relative;
            scroll-snap-align:center;
            transition:all 0.5s cubic-bezier(0.22, 1, 0.36, 1);
            min-height:140px; /* –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ ‚Äî —á—Ç–æ–±—ã –º–∞–ª–µ–Ω—å–∫–∏–µ –∑–∞–¥–∞—á–∏ —Ç–æ–∂–µ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ */
        }

        .task.active {
            transform:scale(1.24) !important;
            box-shadow:0 18px 56px rgba(231,76,60,0.38) !important;
            opacity:1 !important;
        }

        .task:not(.active) {
            transform:scale(0.78);
            opacity:0.58;
        }

        .delete-btn {
            position:absolute;
            top:14px;
            right:18px;
            background:none;
            border:none;
            font-size:2.1rem;
            color:#e74c3c;
            cursor:pointer;
            opacity:0.85;
            transition:all .2s;
        }

        .delete-btn:hover { opacity:1; transform:scale(1.25); }

        .task-text {
            flex:1;
            font-size:clamp(1.3rem, 6.2vw, 1.58rem);
            font-weight:500;
            line-height:1.48;
            word-break:break-word;
            padding-right:70px;
            cursor:text;
        }

        .task-text.long      { font-size:clamp(1.12rem, 5.2vw, 1.35rem); }
        .task-text.very-long { font-size:clamp(1rem, 4.6vw, 1.2rem); }

        .task-status {
            font-size:3.4rem;
            width:68px;
            height:68px;
            display:flex;
            align-items:center;
            justify-content:center;
            flex-shrink:0;
        }

        .add-btn {
            position:fixed;
            bottom:36px;
            right:36px;
            width:78px;
            height:78px;
            border-radius:50%;
            background:var(--accent);
            color:white;
            font-size:3.2rem;
            border:none;
            box-shadow:0 12px 32px rgba(255,107,107,0.48);
            z-index:100;
        }

        #login { position:fixed; inset:0; background:rgba(0,0,0,0.65); display:flex; align-items:center; justify-content:center; z-index:999; }
        #login-form {
            background:white;
            padding:60px 40px;
            border-radius:32px;
            width:90%;
            max-width:420px;
            text-align:center;
        }

        #login-form h2 {
            font-family:'Permanent Marker',cursive;
            color:#e74c3c;
            font-size:3.8rem; /* –±–æ–ª—å—à–æ–π –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π —à—Ä–∏—Ñ—Ç */
            margin:0 0 32px 0;
        }

        #login-form p {
            margin:0 0 28px 0;
            font-size:1.4rem;
        }

        #login-form input[type="tel"] {
            width:100%;
            padding:20px;
            font-size:1.6rem;
            border:2px solid #ffe0e0;
            border-radius:16px;
            margin-bottom:28px;
        }

        #login-form button {
            width:100%;
            padding:22px;
            font-size:1.8rem;
            font-weight:bold;
            background:var(--accent);
            color:white;
            border:none;
            border-radius:20px;
            box-shadow:0 8px 24px rgba(255,107,107,0.5);
        }
    </style>
</head>
<body>

<div id="login">
    <div id="login-form">
        <h2>My Daily</h2>
        <p>–í—Ö–æ–¥ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞</p>
        <input type="tel" id="phone" placeholder="+7 (___) ___-__-__">
        <button onclick="login()">–í–æ–π—Ç–∏</button>
    </div>
</div>

<header>My Daily</header>

<div class="main" style="display:none;">
    <div class="dates-sidebar"><div class="date-list" id="dateList"></div></div>
    <div class="tasks-area">
        <h2 class="date-title" id="dateTitle"></h2>
        <div class="task-carousel"><div class="task-list" id="taskList"></div></div>
    </div>
</div>

<button class="add-btn" onclick="addTask()">+</button>

<script>
    let currentDate = new Date();
    let tasks = JSON.parse(localStorage.getItem('myDaily2026')) || {};
    let currentTaskIndex = 0;

    function formatDateKey(d = currentDate) { return d.toISOString().split('T')[0]; }
    function formatDateShort(d = currentDate) { return d.toLocaleDateString('ru', {weekday:'short', day:'numeric', month:'short'}); }

    function login() {
        const phone = document.getElementById('phone').value.trim();
        if (phone.length < 5) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä");
        document.getElementById('login').style.display = 'none';
        document.querySelector('.main').style.display = 'flex';
        document.querySelector('.add-btn').style.display = 'block';
        loadDates();
        loadDate(currentDate);
    }

    function loadDates() {
        const container = document.getElementById('dateList');
        container.innerHTML = '';
        const datesSet = new Set(Object.keys(tasks));
        for (let i = -14; i <= 14; i++) {
            const d = new Date(); d.setDate(d.getDate() + i);
            datesSet.add(formatDateKey(d));
        }
        [...datesSet].sort().forEach(str => {
            const d = new Date(str);
            const item = document.createElement('div');
            item.className = 'date-item';
            item.textContent = formatDateShort(d);
            if (str === formatDateKey(currentDate)) item.classList.add('selected');
            if (str === formatDateKey(new Date())) item.classList.add('today');
            item.onclick = () => { currentDate = d; currentTaskIndex = 0; loadDate(d); loadDates(); };
            container.appendChild(item);
        });
    }

    function loadDate(date) {
        currentDate = date;
        const key = formatDateKey();
        document.getElementById('dateTitle').textContent = date.toLocaleDateString('ru', {weekday:'long', day:'numeric', month:'long'});
        if (!tasks[key]) tasks[key] = [];

        const list = document.getElementById('taskList');
        list.innerHTML = '';

        if (tasks[key].length === 0) {
            list.innerHTML = '<div style="text-align:center;color:#aaa;font-size:1.5rem;padding:120px 0">–ü–æ–∫–∞ –∑–∞–¥–∞—á –Ω–µ—Ç üòå</div>';
            return;
        }

        tasks[key].forEach((t, i) => {
            const taskEl = document.createElement('div');
            taskEl.className = 'task';
            if (i === currentTaskIndex) taskEl.classList.add('active');

            const del = document.createElement('button');
            del.className = 'delete-btn';
            del.textContent = '√ó';
            del.onclick = e => {
                e.stopPropagation();
                if (confirm('–£–¥–∞–ª–∏—Ç—å?')) {
                    tasks[key].splice(i, 1);
                    if (currentTaskIndex >= tasks[key].length && currentTaskIndex > 0) currentTaskIndex--;
                    save();
                    loadDate(currentDate);
                }
            };
            taskEl.appendChild(del);

            const textSpan = document.createElement('div');
            textSpan.className = 'task-text';
            textSpan.textContent = t.text;
            if (t.text.length > 50) textSpan.classList.add('long');
            if (t.text.length > 100) textSpan.classList.add('very-long');

            textSpan.onclick = e => {
                e.stopPropagation();
                editTask(textSpan, t, key, i);
            };

            const status = document.createElement('div');
            status.className = 'task-status';
            if (t.completed) {
                status.textContent = 'üëç';
            } else {
                const cb = document.createElement('input');
                cb.type = 'checkbox';
                cb.checked = false;
                cb.style.width = '40px';
                cb.style.height = '40px';
                cb.style.accentColor = '#ff6b6b';
                cb.onchange = () => {
                    t.completed = true;
                    save();
                    loadDate(currentDate);
                };
                status.appendChild(cb);
            }

            taskEl.append(textSpan, status);
            list.appendChild(taskEl);
        });

        setTimeout(() => {
            const active = list.querySelector('.task.active');
            if (active) active.scrollIntoView({behavior:'smooth', block:'center'});
        }, 200); // —á—É—Ç—å –±–æ–ª—å—à–µ –∑–∞–¥–µ—Ä–∂–∫–∏ ‚Äî –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏
    }

    function editTask(el, taskObj, key, index) {
        const input = document.createElement('input');
        input.type = 'text';
        input.value = taskObj.text;
        input.style = 'flex:1; font:inherit; font-size:inherit; width:100%; border:none; outline:none; background:transparent; padding:0;';

        input.onblur = () => {
            const newText = input.value.trim();
            if (newText) taskObj.text = newText;
            else { tasks[key].splice(index, 1); if (currentTaskIndex > 0) currentTaskIndex--; }
            save();
            loadDate(currentDate);
        };

        input.onkeydown = e => {
            if (e.key === 'Enter') input.blur();
            if (e.key === 'Escape') { input.value = taskObj.text; input.blur(); }
        };

        el.replaceWith(input);
        input.focus();
        input.select();
    }

    function addTask() {
        const text = prompt('–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞:')?.trim();
        if (!text) return;
        const key = formatDateKey();
        if (!tasks[key]) tasks[key] = [];
        tasks[key].push({text, completed: false});
        currentTaskIndex = tasks[key].length - 1;
        save();
        loadDate(currentDate);
    }

    function save() {
        localStorage.setItem('myDaily2026', JSON.stringify(tasks));
    }

    // –°–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ ‚Äî –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–¥–∞—á–∏ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
    let scrollTimer;
    document.querySelector('.task-carousel').addEventListener('scroll', () => {
        clearTimeout(scrollTimer);
        scrollTimer = setTimeout(() => {
            const tasksEls = document.querySelectorAll('.task');
            if (tasksEls.length === 0) return;

            let bestIndex = 0;
            let minDist = Infinity;

            tasksEls.forEach((el, idx) => {
                const rect = el.getBoundingClientRect();
                const centerY = rect.top + rect.height / 2;
                const viewportCenter = window.innerHeight / 2;
                const dist = Math.abs(centerY - viewportCenter);
                if (dist < minDist) {
                    minDist = dist;
                    bestIndex = idx;
                }
            });

            // –ï—Å–ª–∏ –¥–æ—à–ª–∏ –¥–æ –∫–æ–Ω—Ü–∞ ‚Äî –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –±–µ—Ä—ë–º –ø–æ—Å–ª–µ–¥–Ω—é—é
            if (bestIndex === tasksEls.length - 1 && minDist < 300) { // –ø–æ—Ä–æ–≥, —á—Ç–æ–±—ã –ø–æ—Å–ª–µ–¥–Ω—è—è —Ç–æ—á–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∞—Å—å
                bestIndex = tasksEls.length - 1;
            }

            if (bestIndex !== currentTaskIndex) {
                currentTaskIndex = bestIndex;
                loadDate(currentDate);
            }
        }, 80); // –±—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–ª–∏–∫
    });

    loadDates();
</script>
</body>
</html>
